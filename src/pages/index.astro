---
import ArticleLink from "ğŸ§±/ArticleLink.astro";
import Bio from "ğŸ§±/Bio.astro";
import Navbar from "ğŸ§±/Navbar.astro";
import Layout from "../layouts/Layout.astro";
import Rss from "ğŸ§±/icons/Rss.astro";
import { sub } from "date-fns";
import SectionHeader from "ğŸ§±/SectionHeader.astro";
import HomepageSection from "ğŸ§±/HomepageSection.astro";
import BookGrid from "ğŸ§±/kindle/BookGrid.astro";
import Ultrawide from "ğŸ§±/misc/Ultrawide.astro";
import SpotifySidebar from "ğŸ§±/spotify/SpotifySidebar.astro";
import { LanyardStatus } from "ğŸ§±/lanyard/LanyardStatus";
import { getAllContent } from "ğŸ› ï¸/content";

const visiblePosts = await getAllContent();
---

<Layout title="Xetera">
  <Navbar />
  <main class="flex justify-center w-full my-7xl lg:my-[10%] homepage mx-6">
    <div
      class="flex flex-col gap-8 md:gap-12 mx-auto max-w-7xl w-full px-4 md:px-6"
    >
      <div class="mb-8">
        <Bio />
      </div>
      <div class="grid grid-cols-3 gap-8">
        <div
          class="col-span-full lg:col-span-2 homepage-grid gap-8 flex flex-col"
        >
          <HomepageSection>
            <SectionHeader>
              {visiblePosts.length} Articles ğŸ“
              <a
                slot="aside"
                href="/rss.xml"
                class="underlined inline-flex items-center gap-2 color-text-500"
              >
                <p>Subscribe to the RSS feed</p>
                <Rss />
              </a>
            </SectionHeader>
            <div class="posts flex flex-col gap-3">
              {
                visiblePosts.map((post) => {
                  const isNew = sub(new Date(), { days: 30 }) < post.data.date;

                  return (
                    <div class="post">
                      <ArticleLink {...post} isNew={isNew} />
                    </div>
                  );
                })
              }
            </div>
          </HomepageSection>
          <BookGrid class="grid-area-[books]" />
        </div>
        <div class="col-span-full lg:col-span-1 flex flex-col gap-8">
          {
            import.meta.env.DISCORD_ID && (
              <LanyardStatus
                className="grid-area-[lanyard]"
                discordId={import.meta.env.DISCORD_ID}
                client:idle
              />
            )
          }
          <SpotifySidebar class="grid-area-[spotify]" />
        </div>
      </div>
    </div>
  </main>
</Layout>

<Ultrawide />
